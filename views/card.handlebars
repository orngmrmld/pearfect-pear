<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<!--  I need help formatting this to handlebars - MR -->


<body id="backgroundIMG" onload="initialize()">
    <header class="column has-background-black has-text-right"> 
        <a class=" material-symbols-rounded content" href="?reload">refresh</a>
    </header>

    <script >
        var maps;
        var services;

        function initialize(){
        var paso = new google.maps.LatLng(35.640556,-120.680008);
    
        map = new google.maps.Map(document.getElementById('map'),{
          center: paso,
          zoom: 15  
        });
    
        var input = document.getElementById('searchTextField');
    
        let autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo('bounds',map);
    
        let marker = new google.maps.Marker({
          map: map
        })
    
        google.maps.event.addListener(autocomplete,'place_changed',() =>{
          var place = autocomplete.getPlace();
          map.setZoom(17);
          console.log(place);
          console.log(place.photos[0].getUrl());
    
          if(place.geometry.viewport){
            map.fitBounds(place.geometry.viewport);
          } else {
            map.setCenter(place.geometry.location);
            map.setZoom(17);
          }
          marker.setPosition(place.geometry.location);
          marker.setVisible(true);
     
          let request = {
          location: place.geometry.location,
          radius: '5000',
          type: "movie_theater"
          }
    
          service = new google.maps.places.PlacesService(map);
          service.nearbySearch(request,callback);
        });    
    }
    
      function callback(results, status){     
          if (status== google.maps.places.PlacesServiceStatus.OK){
            for(var i =0;i<results.length;i++){
              var place = results[i];
              createMarker(results[i]);
            }
          }    
      }
    
      function createMarker(place) {
        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });
    

        google.maps.event.addListener(marker, 'click', function () {      
            //localStorage.setItem("place-info",place.name)
            window.open(place.photos[0].getUrl(),"_blank");
        });
      }
    </script>

    <main>
      <div>
    <div class="pt-5"> 
        <h3 class="content has-text-centered has-text-white hide">MAP:</h3><h3 id="place-info"></h3>
    </div>
    <!-- Google Map with markers -->
    <div id="map" class="hide"></div>

    </main>

 
   
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> 
    <script type="text/javascript" src="assets/js/script.js"></script>

</body>
</html>